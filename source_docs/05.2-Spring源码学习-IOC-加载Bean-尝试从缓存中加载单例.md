---
title: 05.2-Spring源码学习-IOC-加载Bean-尝试从缓存中加载单例
date: 2019-04-16
categories: 源码学习
tags: [Spring]
---

> 加载Bean的第二步。

单例在Spring的同一个容器中只会被创建一次，后续再获取Bean，就直接从单例缓存中获取了。

首先**尝试从缓存中加载，如果加载不成功，则尝试从`singletonFactories`中加载。**

> 因为在创建单例bean的时候会存在依赖注入的情况，而在创建依赖的时候为了避免循环依赖，在Spring中创建bean的原则是不等bean创建完成就会将bean的`ObjectFactory`提早曝光加入到缓存中，一旦下一个bean创建时候需要依赖上一个bean则直接使用`ObjectFactory`。

> 关于循环依赖：TODO

从缓存中得到了bean的原始状态，则需要**对bean进行实例化**。缓存中记录的只是最原始的bean状态，并不一定是我们最终想要的bean。

例如：我们需要对工厂bean进行处理，得到的其实是工厂bean的初始状态，但是我们真正需要的是工厂bean中定义的factory-method方法中返回的bean。`getObjectForBeanInstance` 方法就是完成这个工作的。



## 尝试从缓存中加载单例bean

TODO

## bean的实例化

TODO



## 参考资料

- 芋道源码 精尽 Spring 源码分析
- 《Spring源码深度解析 第2版》